{"ast":null,"code":"import _defineProperty from\"C:/Users/Faisal/Desktop/fullstack Projects/Diary Software/my-frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/Faisal/Desktop/fullstack Projects/Diary Software/my-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/Faisal/Desktop/fullstack Projects/Diary Software/my-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Faisal/Desktop/fullstack Projects/Diary Software/my-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Faisal\\\\Desktop\\\\fullstack Projects\\\\Diary Software\\\\my-frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from'react';import'./ConsumerKhata.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ConsumerKhata=function ConsumerKhata(){var getTodayDate=function getTodayDate(){var today=new Date();var year=today.getFullYear();var month=String(today.getMonth()+1).padStart(2,'0');// Pad single digit months with a leading 0\nvar day=String(today.getDate()).padStart(2,'0');// Pad single digit days with a leading 0\nreturn\"\".concat(year,\"-\").concat(month,\"-\").concat(day);// Format must be YYYY-MM-DD\n};var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isFormVisible=_useState2[0],setIsFormVisible=_useState2[1];var _useState3=useState({date:getTodayDate(),consumerName:'',baqaya:''// Initialize as a number\n}),_useState4=_slicedToArray(_useState3,2),consumerData=_useState4[0],setConsumerData=_useState4[1];var _useState5=useState({date:getTodayDate(),wasooli:''}),_useState6=_slicedToArray(_useState5,2),wasooliData=_useState6[0],setWasooliData=_useState6[1];var _useState7=useState({date:'',consumerName:'',baqaya:''}),_useState8=_slicedToArray(_useState7,2),errorMessages=_useState8[0],setErrorMessages=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isDataSaved=_useState10[0],setIsDataSaved=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isUpdateMode=_useState12[0],setIsUpdateMode=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isAddBaqayaVisible=_useState14[0],setIsAddBaqayaVisible=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),baqayaToAdd=_useState16[0],setBaqayaToAdd=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),baqayaError=_useState18[0],setBaqayaError=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),consumers=_useState20[0],setConsumers=_useState20[1];var _useState21=useState(null),_useState22=_slicedToArray(_useState21,2),selectedConsumerId=_useState22[0],setSelectedConsumerId=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),isConfirmModalVisible=_useState24[0],setIsConfirmModalVisible=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),isAlertVisible=_useState26[0],setIsAlertVisible=_useState26[1];var _useState27=useState(''),_useState28=_slicedToArray(_useState27,2),alertMessage=_useState28[0],setAlertMessage=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),isAddConsumerConfirmVisible=_useState30[0],setIsAddConsumerConfirmVisible=_useState30[1];var _useState31=useState({}),_useState32=_slicedToArray(_useState31,2),monthVisibility=_useState32[0],setMonthVisibility=_useState32[1];var _useState33=useState(false),_useState34=_slicedToArray(_useState33,2),isWasooliVisible=_useState34[0],setIsWasooliVisible=_useState34[1];var _useState35=useState(null),_useState36=_slicedToArray(_useState35,2),currentManaging=_useState36[0],setCurrentManaging=_useState36[1];// Update this state to also include the wasooliId\nvar _useState37=useState({}),_useState38=_slicedToArray(_useState37,2),monthYearButtonsVisibility=_useState38[0],setMonthYearButtonsVisibility=_useState38[1];var _useState39=useState('English'),_useState40=_slicedToArray(_useState39,2),language=_useState40[0],setLanguage=_useState40[1];var _useState41=useState({consumerId:null,wasooliId:null,// Add this line\nindex:null}),_useState42=_slicedToArray(_useState41,2),deleteConfirmationData=_useState42[0],setDeleteConfirmationData=_useState42[1];var _useState43=useState(null),_useState44=_slicedToArray(_useState43,2),editingTransaction=_useState44[0],setEditingTransaction=_useState44[1];var _useState45=useState({date:'',wasooli:''}),_useState46=_slicedToArray(_useState45,2),wasooliErrorMessages=_useState46[0],setWasooliErrorMessages=_useState46[1];var translations={English:{consumerKhata:\"Consumer Khata\",addConsumer:\"Add Consumer\",date:\"Date\",consumerName:\"Consumer Name\",baqaya:\"Baqaya\",save:\"Save\",update:\"Update\",manage:\"Manage\",addBaqaya:\"Add Baqaya\",showAll:\"Show All\",hideAll:\"Hide All\",wasooli:\"Wasooli\",saveWasooli:\"Save Wasooli\",delete:\"Delete\",Khata:\"Khata\",confirmAddConsumer:\"Are you sure you want to add a new consumer?\",yes:\"Yes\",no:\"No\",deleteWasooliConfirm:\"Are you sure you want to delete this Wasooli?\",close:\"Close\",Show:\"Show\",Hide:\"Hide\",datee:\"Please enter a date\",consumerNamee:\"Please enter consumer name\",baqayaa:\"Please enter baqaya amount\",baqayaNumberr:\"Baqaya must be a number\",wasooliAmountt:\"Please fill up the Wasooli amount\",baqayaerror:\"Please fill up the baqaya amount\",wasooliDatee:\"Date is required\"},Urdu:{consumerKhata:\"صارف خاتہ \",addConsumer:\"صارف شامل کریں\",date:\"تاریخ\",consumerName:\"صارف کا نام\",baqaya:\"باقیہ\",save:\"محفوظ کریں\",update:\"اپ ڈیٹ\",manage:\"انتظام کریں\",addBaqaya:\"باقیہ شامل کریں\",showAll:\"سب دکھائیں\",hideAll:\"پوشیدہ کریں\",wasooli:\"وصولی\",saveWasooli:\"وصولی محفوظ کریں\",delete:\"حذف کریں\",confirmAddConsumer:\"کیا آپ واقعی نیا صارف شامل کرنا چاہتے ہیں؟\",yes:\"جی ہاں\",no:\"نہیں\",Khata:\"خاتہ\",Show:\"دکھائیں\",Hide:\"چھپائیں\",deleteWasooliConfirm:\"کیا آپ واقعی اس وصولی کو حذف کرنا چاہتے ہیں؟\",close:\"بند کریں\",datee:\"براہ کرم تاریخ درج کریں\",consumerNamee:\"براہ کرم صارف کا نام درج کریں\",baqayaa:\"براہ کرم باقیہ مقدار درج کریں\",baqayaNumberr:\"باقیہ کو نمبر ہونا چاہئے\",wasooliAmountt:\"براہ کرم وصولی کی رقم بھریں\",wasooliDatee:\"تاریخ ضروری ہے\",baqayaerror:\"برائے مہربانی باقیہ رقم بھریں\"}};var monthTranslations={January:\"جنوری\",February:\"فروری\",March:\"مارچ\",April:\"اپریل\",May:\"مئی\",June:\"جون\",July:\"جولائی\",August:\"اگست\",September:\"ستمبر\",October:\"اکتوبر\",November:\"نومبر\",December:\"دسمبر\"};var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,consumersData,updatedConsumersData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch('http://localhost:3001/consumerkhata');case 3:response=_context2.sent;if(response.ok){_context2.next=6;break;}throw new Error(\"HTTP error! status: \".concat(response.status));case 6:_context2.next=8;return response.json();case 8:consumersData=_context2.sent;_context2.next=11;return Promise.all(consumersData.map(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(consumer){var wasooliResponse,wasooliData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"http://localhost:3001/wasooli/\".concat(consumer.idconsumerkhata));case 2:wasooliResponse=_context.sent;if(wasooliResponse.ok){_context.next=6;break;}console.log(\"Failed to fetch wasooli data for consumer ID: \".concat(consumer.idconsumerkhata));return _context.abrupt(\"return\",consumer);case 6:_context.next=8;return wasooliResponse.json();case 8:wasooliData=_context.sent;return _context.abrupt(\"return\",_objectSpread(_objectSpread({},consumer),{},{wasooliTransactions:wasooliData}));case 10:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}()));case 11:updatedConsumersData=_context2.sent;// Update state with the processed and fetched data\nsetConsumers(updatedConsumersData);_context2.next=18;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](0);console.error('Fetch error:',_context2.t0);case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[0,15]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();useEffect(function(){fetchData();},[]);var CustomModal=function CustomModal(_ref3){var message=_ref3.message,onClose=_ref3.onClose;return/*#__PURE__*/_jsx(\"div\",{className:\"custom-modal-overlay\",children:/*#__PURE__*/_jsx(\"div\",{className:\"custom-modal\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"custom-modal-content\",children:[/*#__PURE__*/_jsx(\"p\",{children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,children:\"Close\"})]})})});};var toggleMonthYearButtonsVisibility=function toggleMonthYearButtonsVisibility(consumerId){setMonthYearButtonsVisibility(function(prevState){var newState=_objectSpread(_objectSpread({},prevState),{},_defineProperty({},consumerId,!prevState[consumerId]));return newState;});};var handleInputChange=function handleInputChange(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;var newValue=value;// If the input is for baqaya, ensure it's handled as a number\nif(name==='baqaya'){newValue=value!==''?parseInt(value,10):0;if(isNaN(newValue)){setErrorMessages(function(prevErrors){return _objectSpread(_objectSpread({},prevErrors),{},{baqaya:'Baqaya must be a number'});});return;// Don't set the consumer data if the input is not a number\n}}setConsumerData(function(prevData){return _objectSpread(_objectSpread({},prevData),{},_defineProperty({},name,newValue));});// Clear any error messages for this input\nsetErrorMessages(function(prevErrors){return _objectSpread(_objectSpread({},prevErrors),{},_defineProperty({},name,''));});};var handleSaveClick=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var date,consumerName,baqaya,idconsumerkhata,errors,endpoint,method,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:date=consumerData.date,consumerName=consumerData.consumerName,baqaya=consumerData.baqaya,idconsumerkhata=consumerData.idconsumerkhata;errors={};if(!(!date||!consumerName||!baqaya)){_context3.next=6;break;}errors=_objectSpread(_objectSpread(_objectSpread({},!date&&{date:\"Please enter a date\"}),!consumerName&&{consumerName:\"Please enter consumer name\"}),!baqaya&&{baqaya:\"Please enter baqaya amount\"});setErrorMessages(errors);return _context3.abrupt(\"return\");case 6:endpoint=idconsumerkhata?\"http://localhost:3001/consumerkhata/\".concat(idconsumerkhata):'http://localhost:3001/consumerkhata';method=idconsumerkhata?'PUT':'POST';_context3.prev=8;_context3.next=11;return fetch(endpoint,{method:method,headers:{'Content-Type':'application/json'},body:JSON.stringify({Date:date,name:consumerName,baqaya:parseInt(baqaya)})});case 11:response=_context3.sent;if(response.ok){_context3.next=14;break;}throw new Error(\"HTTP error! status: \".concat(response.status));case 14:_context3.next=16;return fetchData();case 16:resetForm();_context3.next=22;break;case 19:_context3.prev=19;_context3.t0=_context3[\"catch\"](8);console.error('Error:',_context3.t0);case 22:case\"end\":return _context3.stop();}}},_callee3,null,[[8,19]]);}));return function handleSaveClick(){return _ref4.apply(this,arguments);};}();var resetForm=function resetForm(){setConsumerData({date:'',consumerName:'',baqaya:''});setIsFormVisible(false);setErrorMessages({});};var handleCancelClick=function handleCancelClick(){setIsFormVisible(false);setIsUpdateMode(false);};var handleUpdateClick=function handleUpdateClick(id){var consumerToUpdate=consumers.find(function(consumer){return consumer.idconsumerkhata===id;});if(consumerToUpdate){setConsumerData({date:consumerToUpdate.Date||'',consumerName:consumerToUpdate.name||'',baqaya:consumerToUpdate.baqaya||'',idconsumerkhata:consumerToUpdate.idconsumerkhata// Store the id in the state\n});setIsUpdateMode(true);setIsFormVisible(true);}else{console.error(\"No consumer found with ID:\",id);}};var handleAddBaqayaClick=function handleAddBaqayaClick(){setIsAddBaqayaVisible(true);};var handleBaqayaInputChange=function handleBaqayaInputChange(e){var value=e.target.value;setBaqayaToAdd(value);setBaqayaError('');};var handleSaveBaqayaClick=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var newBaqayaAmount,consumerToUpdate,currentBaqaya,updatedBaqaya,response,updatedConsumers;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(baqayaToAdd){_context4.next=3;break;}setBaqayaError('Please fill the Baqaya field');return _context4.abrupt(\"return\");case 3:newBaqayaAmount=parseInt(baqayaToAdd);if(!isNaN(newBaqayaAmount)){_context4.next=7;break;}setBaqayaError('Invalid Baqaya amount');return _context4.abrupt(\"return\");case 7:// Find the consumer to update\nconsumerToUpdate=consumers.find(function(consumer){return consumer.idconsumerkhata===selectedConsumerId;});if(consumerToUpdate){_context4.next=11;break;}console.error(\"Consumer not found\");return _context4.abrupt(\"return\");case 11:// Ensure consumerToUpdate.baqaya is a number\ncurrentBaqaya=parseInt(consumerToUpdate.baqaya)||0;// Calculate updated baqaya\nupdatedBaqaya=currentBaqaya+newBaqayaAmount;// Send the update request to the server\n_context4.prev=13;_context4.next=16;return fetch(\"http://localhost:3001/consumerkhata/\".concat(selectedConsumerId),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(_objectSpread(_objectSpread({},consumerToUpdate),{},{baqaya:updatedBaqaya// Update with the calculated baqaya\n}))});case 16:response=_context4.sent;if(response.ok){_context4.next=19;break;}throw new Error(\"HTTP error! status: \".concat(response.status));case 19:// Update the local state to reflect the change\nupdatedConsumers=consumers.map(function(consumer){return consumer.idconsumerkhata===selectedConsumerId?_objectSpread(_objectSpread({},consumer),{},{baqaya:updatedBaqaya.toString()}):consumer;});setConsumers(updatedConsumers);setIsDataSaved(true);setBaqayaToAdd('');setIsAddBaqayaVisible(false);setBaqayaError('');// Optionally, refresh the data from the server to ensure UI consistency\nfetchData();_context4.next=32;break;case 28:_context4.prev=28;_context4.t0=_context4[\"catch\"](13);console.error('Error updating baqaya:',_context4.t0);setBaqayaError('Failed to update baqaya');case 32:case\"end\":return _context4.stop();}}},_callee4,null,[[13,28]]);}));return function handleSaveBaqayaClick(){return _ref5.apply(this,arguments);};}();var toggleMonthVisibility=function toggleMonthVisibility(consumerId,monthYear){setMonthVisibility(function(prevVisibility){var _prevVisibility$consu,_prevVisibility$consu2;return _objectSpread(_objectSpread({},prevVisibility),{},_defineProperty({},consumerId,_objectSpread(_objectSpread({},prevVisibility[consumerId]),{},_defineProperty({},monthYear,!((_prevVisibility$consu=(_prevVisibility$consu2=prevVisibility[consumerId])===null||_prevVisibility$consu2===void 0?void 0:_prevVisibility$consu2[monthYear])!==null&&_prevVisibility$consu!==void 0?_prevVisibility$consu:false)))));});};// Adjust handleSaveClick or create a new function to send the updated consumer data to the server\n// This involves crafting a PUT request with the consumer's updated data\nvar ConfirmAddModal=function ConfirmAddModal(_ref6){var isOpen=_ref6.isOpen,onConfirm=_ref6.onConfirm,onCancel=_ref6.onCancel;if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"confirm-modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"confirm-modal\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\" \",translations[language].confirmAddConsumer]}),/*#__PURE__*/_jsxs(\"button\",{className:\"confirm-modal-button confirm-modal-button-yes\",onClick:onConfirm,children:[\" \",translations[language].yes]}),/*#__PURE__*/_jsxs(\"button\",{className:\"confirm-modal-button confirm-modal-button-no\",onClick:onCancel,children:[\" \",translations[language].no]})]})});};var handleAddConsumerClick=function handleAddConsumerClick(){setIsAddConsumerConfirmVisible(true);};var handleUpdateWasooliClick=function handleUpdateWasooliClick(consumerId,transactionId){if(!consumerId||!transactionId){console.error('Missing consumer ID or transaction ID');return;}var consumer=consumers.find(function(consumer){return consumer.idconsumerkhata===consumerId;});if(!consumer){console.error('Consumer not found for ID:',consumerId);setIsAlertVisible(true);setAlertMessage(\"Error: Consumer not found\");return;}console.log(\"Consumer found:\",consumer.name);if(!consumer.wasooliTransactions||consumer.wasooliTransactions.length===0){console.error('No transactions found for consumer:',consumer.name);return;}console.log(\"Consumer's Wasooli Transactions:\",consumer.wasooliTransactions);var selectedWasooliCard=consumer.wasooliTransactions.find(function(txn){return txn.idwasooli.toString()===transactionId.toString();});if(!selectedWasooliCard){console.error('Wasooli transaction not found for ID:',transactionId,\"in consumer:\",consumer.name);return;}console.log(\"Selected Wasooli Card:\",selectedWasooliCard);// Update the form data and editing transaction state asynchronously\nsetWasooliData({date:selectedWasooliCard.date,wasooli:selectedWasooliCard.Wasooli.toString()});setEditingTransaction({consumerId:consumerId,transactionId:transactionId});setIsWasooliVisible(true);};var handleManageClick=function handleManageClick(consumerId){setSelectedConsumerId(consumerId);setIsWasooliVisible(true);setCurrentManaging(consumerId);// Reset Wasooli form data\nsetWasooliData({date:'',Wasooli:''});};var handleWasooliInputChange=function handleWasooliInputChange(e){var _e$target2=e.target,name=_e$target2.name,value=_e$target2.value;setWasooliData(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},name,value));});};var handleConfirmDeletion=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var consumerId,wasooliId,index,deleteResponse,errorData;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:consumerId=deleteConfirmationData.consumerId,wasooliId=deleteConfirmationData.wasooliId,index=deleteConfirmationData.index;if(wasooliId){_context5.next=4;break;}console.error(\"Wasooli ID is missing.\");return _context5.abrupt(\"return\");case 4:_context5.prev=4;_context5.next=7;return fetch(\"http://localhost:3001/wasooli/\".concat(wasooliId),{method:'DELETE'});case 7:deleteResponse=_context5.sent;if(deleteResponse.ok){_context5.next=13;break;}_context5.next=11;return deleteResponse.json();case 11:errorData=_context5.sent;throw new Error(errorData.message||'Failed to delete Wasooli transaction.');case 13:console.log(\"Wasooli transaction deleted successfully.\");// Re-fetch updated consumer data to refresh local state\n_context5.next=16;return fetchData();case 16:console.log(\"Consumer data refreshed after Wasooli deletion.\");// Reset the delete confirmation data and close the modal\nsetDeleteConfirmationData({consumerId:null,wasooliId:null,index:null});setIsConfirmModalVisible(false);_context5.next=24;break;case 21:_context5.prev=21;_context5.t0=_context5[\"catch\"](4);console.error('Error during Wasooli deletion:',_context5.t0);case 24:case\"end\":return _context5.stop();}}},_callee5,null,[[4,21]]);}));return function handleConfirmDeletion(){return _ref7.apply(this,arguments);};}();var handleCancelDeletion=function handleCancelDeletion(){setIsConfirmModalVisible(false);// Hide the modal\n};var handleDeleteWasooliClick=function handleDeleteWasooliClick(consumerId,wasooliId,index){// Log the parameters to ensure they are being passed correctly\nconsole.log(\"Preparing to delete Wasooli with ID: \".concat(wasooliId,\", for Consumer ID: \").concat(consumerId,\", at Index: \").concat(index));// Set the deleteConfirmationData with the correct values\nsetDeleteConfirmationData({consumerId:consumerId,wasooliId:wasooliId,index:index});setIsConfirmModalVisible(true);};var AlertModal=function AlertModal(_ref8){var isOpen=_ref8.isOpen,message=_ref8.message,onClose=_ref8.onClose;if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"alert-modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"alert-modal\",children:[/*#__PURE__*/_jsx(\"p\",{children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,children:\"OK\"})]})});};var ConfirmationModal=function ConfirmationModal(_ref9){var onConfirm=_ref9.onConfirm,onCancel=_ref9.onCancel;return/*#__PURE__*/_jsx(\"div\",{className:\"confirmation-modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"confirmation-modal\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\" \",translations[language].deleteWasooliConfirm]}),/*#__PURE__*/_jsxs(\"button\",{className:\"yes-button\",onClick:onConfirm,children:[\" \",translations[language].yes]}),/*#__PURE__*/_jsxs(\"button\",{className:\"no-button\",onClick:onCancel,children:[\" \",translations[language].no]})]})});};var handleSaveWasooliClick=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var wasooliAmount,payload,endpoint,method,response,errorData;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;wasooliAmount=parseInt(wasooliData.wasooli);if(!(wasooliAmount<=0)){_context6.next=4;break;}throw new Error(\"invalid Wasooli amount\");case 4:if(!isNaN(wasooliAmount)){_context6.next=6;break;}throw new Error(\"Please fill up the Wasooli amount\");case 6:if(wasooliData.date){_context6.next=8;break;}throw new Error(\"Date is required\");case 8:payload={date:wasooliData.date,Wasooli:wasooliAmount};endpoint='http://localhost:3001/wasooli';method='POST';// If we're editing an existing transaction, adjust the endpoint and method.\n// Otherwise, ensure the consumer ID is included in the payload for new transactions.\nif(!(editingTransaction&&editingTransaction.transactionId)){_context6.next=16;break;}endpoint+=\"/\".concat(editingTransaction.transactionId);method='PUT';_context6.next=19;break;case 16:if(selectedConsumerId){_context6.next=18;break;}throw new Error(\"Consumer ID is missing for new Wasooli transaction\");case 18:payload=_objectSpread(_objectSpread({},payload),{},{consumerId:selectedConsumerId});case 19:_context6.next=21;return fetch(endpoint,{method:method,headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});case 21:response=_context6.sent;if(response.ok){_context6.next=27;break;}_context6.next=25;return response.json();case 25:errorData=_context6.sent;throw new Error(errorData.message||\"Failed to save Wasooli transaction\");case 27:_context6.t0=console;_context6.next=30;return response.json();case 30:_context6.t1=_context6.sent;_context6.t0.log.call(_context6.t0,\"Wasooli transaction saved:\",_context6.t1);setIsWasooliVisible(false);setWasooliData({date:'',wasooli:''});setEditingTransaction(null);_context6.next=37;return fetchData();case 37:_context6.next=44;break;case 39:_context6.prev=39;_context6.t2=_context6[\"catch\"](0);console.error(\"Error saving Wasooli transaction:\",_context6.t2);setIsAlertVisible(true);setAlertMessage(_context6.t2.toString());case 44:case\"end\":return _context6.stop();}}},_callee6,null,[[0,39]]);}));return function handleSaveWasooliClick(){return _ref10.apply(this,arguments);};}();// Toggle visibility for an individual month (optional, if you need finer control)\nvar renderWasooliTransactions=function renderWasooliTransactions(consumer){// Ensure consumer.wasooliTransactions is an array.\nvar transactions=consumer.wasooliTransactions||[];var transactionsByMonth=transactions.reduce(function(acc,transaction){var monthYear=new Date(transaction.date).toLocaleString('default',{month:'long',year:'numeric'});if(!acc[monthYear])acc[monthYear]=[];acc[monthYear].push(transaction);return acc;},{});return Object.entries(transactionsByMonth).map(function(_ref11){var _monthVisibility$cons,_monthVisibility$cons2;var _ref12=_slicedToArray(_ref11,2),monthYear=_ref12[0],transactions=_ref12[1];// Check if the monthYear is visible based on the state.\nvar isButtonVisible=monthYearButtonsVisibility[consumer.idconsumerkhata];var isDataVisible=(_monthVisibility$cons=(_monthVisibility$cons2=monthVisibility[consumer.idconsumerkhata])===null||_monthVisibility$cons2===void 0?void 0:_monthVisibility$cons2[monthYear])!==null&&_monthVisibility$cons!==void 0?_monthVisibility$cons:false;return/*#__PURE__*/_jsxs(\"div\",{children:[isButtonVisible&&/*#__PURE__*/_jsxs(\"button\",{className:\"toggle-visibility-button\",onClick:function onClick(){return toggleMonthVisibility(consumer.idconsumerkhata,monthYear);},children:[isDataVisible?translations[language].Hide:translations[language].Show,\" \",monthYear]}),isDataVisible&&transactions.map(function(transaction,index){return/*#__PURE__*/_jsxs(\"div\",{className:\"wasooli-card-horizontal\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[translations[language].date,\" : \",transaction.date]}),\" \",/*#__PURE__*/_jsxs(\"span\",{children:[translations[language].wasooli,\" : \",transaction.Wasooli]}),\" \",/*#__PURE__*/_jsx(\"button\",{className:\"updatee-button\",onClick:function onClick(){return handleUpdateWasooliClick(consumer.idconsumerkhata,transaction.idwasooli);},children:translations[language].update}),/*#__PURE__*/_jsx(\"button\",{className:\"deletee-button\",onClick:function onClick(){return handleDeleteWasooliClick(consumer.idconsumerkhata,transaction.idwasooli,index);},children:translations[language].delete})]},index);})]},monthYear);});};return/*#__PURE__*/_jsxs(\"div\",{className:\"consumer-khata-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"header\",children:translations[language].consumerKhata}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setLanguage(function(lang){return lang==='English'?'Urdu':'English';});},className:\"language-toggle\",children:language==='English'?'اردو':'English'}),isConfirmModalVisible&&/*#__PURE__*/_jsx(ConfirmationModal,{onConfirm:handleConfirmDeletion,onCancel:handleCancelDeletion}),/*#__PURE__*/_jsx(AlertModal,{isOpen:isAlertVisible,message:alertMessage,onClose:function onClose(){return setIsAlertVisible(false);}}),consumers.map(function(consumer){return/*#__PURE__*/_jsxs(\"div\",{className:\"consumer-card\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"consumer-name\",children:[consumer.name,\" \",translations[language].Khata]}),/*#__PURE__*/_jsxs(\"p\",{children:[translations[language].date,\" : \",consumer.Date]}),/*#__PURE__*/_jsxs(\"p\",{children:[translations[language].consumerName,\" : \",consumer.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[translations[language].baqaya,\" : \",consumer.baqaya]}),/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"manage-buttonn\",onClick:function onClick(){return handleManageClick(consumer.idconsumerkhata);},children:translations[language].manage}),/*#__PURE__*/_jsx(\"button\",{className:\"add-baqaya-buttonn\",onClick:function onClick(){setIsAddBaqayaVisible(true);setSelectedConsumerId(consumer.idconsumerkhata);// Ensure this is set when opening the Baqaya add form\n},children:translations[language].addBaqaya}),/*#__PURE__*/_jsx(\"button\",{className:\"update-buttonn\",onClick:function onClick(){return handleUpdateClick(consumer.idconsumerkhata);},children:translations[language].update})]}),/*#__PURE__*/_jsx(\"button\",{className:\"global-toggle-buttonn\",onClick:function onClick(){return toggleMonthYearButtonsVisibility(consumer.idconsumerkhata);},children:monthYearButtonsVisibility[consumer.idconsumerkhata]?translations[language].hideAll:translations[language].showAll}),renderWasooliTransactions(consumer),currentManaging===consumer.idconsumerkhata&&isWasooliVisible&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-container wasooli-card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:translations[language].wasooli}),/*#__PURE__*/_jsx(\"button\",{className:\"close-button\",onClick:function onClick(){return setIsWasooliVisible(false);},children:\"\\u2715\"}),/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:wasooliErrorMessages.date}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"date\",placeholder:translations[language].datee,value:wasooliData.date||'',onChange:handleWasooliInputChange}),/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:wasooliErrorMessages.wasooli}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"wasooli\",placeholder:translations[language].wasooliAmountt,value:wasooliData.wasooli||''// Fallback to empty string if undefined\n,onChange:handleWasooliInputChange}),/*#__PURE__*/_jsx(\"button\",{className:\"save-button\",onClick:function onClick(e){e.preventDefault();handleSaveWasooliClick();},children:translations[language].saveWasooli})]}),selectedConsumerId===consumer.idconsumerkhata&&isAddBaqayaVisible&&/*#__PURE__*/_jsxs(\"div\",{className:\"add-baqaya-card\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"close-button\",onClick:function onClick(){return setIsAddBaqayaVisible(false);},children:\"\\u2715\"}),/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:baqayaError}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:translations[language].baqayaa,value:baqayaToAdd,onChange:handleBaqayaInputChange}),/*#__PURE__*/_jsx(\"button\",{className:\"save-baqaya-button\",onClick:handleSaveBaqayaClick,children:translations[language].save})]})]},consumer.idconsumerkhata);}),/*#__PURE__*/_jsx(ConfirmAddModal,{isOpen:isAddConsumerConfirmVisible,onConfirm:function onConfirm(){setIsAddConsumerConfirmVisible(false);setIsFormVisible(true);// Show the form if the user confirms\n},onCancel:function onCancel(){return setIsAddConsumerConfirmVisible(false);}}),isFormVisible&&/*#__PURE__*/_jsxs(\"div\",{className:\"form-container\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"close-button\",onClick:handleCancelClick,children:\"\\u2715\"}),/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errorMessages.date}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"date\",placeholder:translations[language].datee,value:consumerData.date,onChange:handleInputChange}),/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errorMessages.consumerName}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"consumerName\",placeholder:translations[language].consumerNamee,value:consumerData.consumerName,onChange:handleInputChange}),/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errorMessages.baqaya}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"baqaya\",placeholder:translations[language].baqayaa,value:consumerData.baqaya,onChange:handleInputChange}),/*#__PURE__*/_jsx(\"button\",{className:\"save-button\",onClick:handleSaveClick,children:translations[language].save})]}),/*#__PURE__*/_jsx(\"button\",{className:\"add-button\",onClick:handleAddConsumerClick,children:translations[language].addConsumer})]});};export default ConsumerKhata;","map":{"version":3,"sources":["C:/Users/Faisal/Desktop/fullstack Projects/Diary Software/my-frontend/src/ConsumerKhata.jsx"],"names":["React","useState","useEffect","ConsumerKhata","getTodayDate","today","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","isFormVisible","setIsFormVisible","date","consumerName","baqaya","consumerData","setConsumerData","wasooli","wasooliData","setWasooliData","errorMessages","setErrorMessages","isDataSaved","setIsDataSaved","isUpdateMode","setIsUpdateMode","isAddBaqayaVisible","setIsAddBaqayaVisible","baqayaToAdd","setBaqayaToAdd","baqayaError","setBaqayaError","consumers","setConsumers","selectedConsumerId","setSelectedConsumerId","isConfirmModalVisible","setIsConfirmModalVisible","isAlertVisible","setIsAlertVisible","alertMessage","setAlertMessage","isAddConsumerConfirmVisible","setIsAddConsumerConfirmVisible","monthVisibility","setMonthVisibility","isWasooliVisible","setIsWasooliVisible","currentManaging","setCurrentManaging","monthYearButtonsVisibility","setMonthYearButtonsVisibility","language","setLanguage","consumerId","wasooliId","index","deleteConfirmationData","setDeleteConfirmationData","editingTransaction","setEditingTransaction","wasooliErrorMessages","setWasooliErrorMessages","translations","English","consumerKhata","addConsumer","save","update","manage","addBaqaya","showAll","hideAll","saveWasooli","delete","Khata","confirmAddConsumer","yes","no","deleteWasooliConfirm","close","Show","Hide","datee","consumerNamee","baqayaa","baqayaNumberr","wasooliAmountt","baqayaerror","wasooliDatee","Urdu","monthTranslations","January","February","March","April","May","June","July","August","September","October","November","December","fetchData","fetch","response","ok","Error","status","json","consumersData","Promise","all","map","consumer","idconsumerkhata","wasooliResponse","console","log","wasooliTransactions","updatedConsumersData","error","CustomModal","message","onClose","toggleMonthYearButtonsVisibility","prevState","newState","handleInputChange","e","target","name","value","newValue","parseInt","isNaN","prevErrors","prevData","handleSaveClick","errors","endpoint","method","headers","body","JSON","stringify","resetForm","handleCancelClick","handleUpdateClick","id","consumerToUpdate","find","handleAddBaqayaClick","handleBaqayaInputChange","handleSaveBaqayaClick","newBaqayaAmount","currentBaqaya","updatedBaqaya","updatedConsumers","toString","toggleMonthVisibility","monthYear","prevVisibility","ConfirmAddModal","isOpen","onConfirm","onCancel","handleAddConsumerClick","handleUpdateWasooliClick","transactionId","length","selectedWasooliCard","txn","idwasooli","Wasooli","handleManageClick","handleWasooliInputChange","handleConfirmDeletion","deleteResponse","errorData","handleCancelDeletion","handleDeleteWasooliClick","AlertModal","ConfirmationModal","handleSaveWasooliClick","wasooliAmount","payload","renderWasooliTransactions","transactions","transactionsByMonth","reduce","acc","transaction","toLocaleString","push","Object","entries","isButtonVisible","isDataVisible","lang","preventDefault"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport './ConsumerKhata.css';\r\n\r\nconst ConsumerKhata = () => {\r\n\r\n  const getTodayDate = () => {\r\n    const today = new Date();\r\n    const year = today.getFullYear();\r\n    const month = String(today.getMonth() + 1).padStart(2, '0'); // Pad single digit months with a leading 0\r\n    const day = String(today.getDate()).padStart(2, '0'); // Pad single digit days with a leading 0\r\n    return `${year}-${month}-${day}`; // Format must be YYYY-MM-DD\r\n  };\r\n\r\n  const [isFormVisible, setIsFormVisible] = useState(false);\r\n  const [consumerData, setConsumerData] = useState({\r\n    date: getTodayDate(),\r\n    consumerName: '',\r\n    baqaya: '', // Initialize as a number\r\n  });\r\n  const [wasooliData, setWasooliData] = useState({\r\n    date: getTodayDate(),\r\n    wasooli: '',\r\n  });\r\n\r\n  const [errorMessages, setErrorMessages] = useState({\r\n    date: '',\r\n    consumerName: '',\r\n    baqaya: '',\r\n  });\r\n  const [isDataSaved, setIsDataSaved] = useState(false);\r\n  const [isUpdateMode, setIsUpdateMode] = useState(false);\r\n  const [isAddBaqayaVisible, setIsAddBaqayaVisible] = useState(false);\r\n  const [baqayaToAdd, setBaqayaToAdd] = useState('');\r\n  const [baqayaError, setBaqayaError] = useState('');\r\n  const [consumers, setConsumers] = useState([]);\r\n  const [selectedConsumerId, setSelectedConsumerId] = useState(null);\r\n  const [isConfirmModalVisible, setIsConfirmModalVisible] = useState(false);\r\n  const [isAlertVisible, setIsAlertVisible] = useState(false);\r\n  const [alertMessage, setAlertMessage] = useState('');\r\n  const [isAddConsumerConfirmVisible, setIsAddConsumerConfirmVisible] = useState(false);\r\n  const [monthVisibility, setMonthVisibility] = useState({})\r\n  const [isWasooliVisible, setIsWasooliVisible] = useState(false);\r\n  const [currentManaging, setCurrentManaging] = useState(null);\r\n  // Update this state to also include the wasooliId\r\n  const [monthYearButtonsVisibility, setMonthYearButtonsVisibility] = useState({});\r\n  const [language, setLanguage] = useState('English');\r\n  const [deleteConfirmationData, setDeleteConfirmationData] = useState({\r\n    consumerId: null,\r\n    wasooliId: null, // Add this line\r\n    index: null,\r\n  });\r\n  const [editingTransaction, setEditingTransaction] = useState(null);\r\n\r\n  const [wasooliErrorMessages, setWasooliErrorMessages] = useState({\r\n    date: '',\r\n    wasooli: '',\r\n  });\r\n\r\n  const translations = {\r\n    English: {\r\n      consumerKhata: \"Consumer Khata\",\r\n      addConsumer: \"Add Consumer\",\r\n      date: \"Date\",\r\n      consumerName: \"Consumer Name\",\r\n      baqaya: \"Baqaya\",\r\n      save: \"Save\",\r\n      update: \"Update\",\r\n      manage: \"Manage\",\r\n      addBaqaya: \"Add Baqaya\",\r\n      showAll: \"Show All\",\r\n      hideAll: \"Hide All\",\r\n      wasooli: \"Wasooli\",\r\n      saveWasooli: \"Save Wasooli\",\r\n      delete: \"Delete\",\r\n      Khata: \"Khata\",\r\n      confirmAddConsumer: \"Are you sure you want to add a new consumer?\",\r\n      yes: \"Yes\",\r\n      no: \"No\",\r\n      deleteWasooliConfirm: \"Are you sure you want to delete this Wasooli?\",\r\n      close: \"Close\",\r\n      Show: \"Show\",\r\n      Hide: \"Hide\",\r\n      datee: \"Please enter a date\",\r\n      consumerNamee: \"Please enter consumer name\",\r\n      baqayaa: \"Please enter baqaya amount\",\r\n      baqayaNumberr: \"Baqaya must be a number\",\r\n      wasooliAmountt: \"Please fill up the Wasooli amount\",\r\n      baqayaerror: \"Please fill up the baqaya amount\",\r\n      wasooliDatee: \"Date is required\"\r\n    },\r\n    Urdu: {\r\n      consumerKhata: \"صارف خاتہ \",\r\n      addConsumer: \"صارف شامل کریں\",\r\n      date: \"تاریخ\",\r\n      consumerName: \"صارف کا نام\",\r\n      baqaya: \"باقیہ\",\r\n      save: \"محفوظ کریں\",\r\n      update: \"اپ ڈیٹ\",\r\n      manage: \"انتظام کریں\",\r\n      addBaqaya: \"باقیہ شامل کریں\",\r\n      showAll: \"سب دکھائیں\",\r\n      hideAll: \"پوشیدہ کریں\",\r\n      wasooli: \"وصولی\",\r\n      saveWasooli: \"وصولی محفوظ کریں\",\r\n      delete: \"حذف کریں\",\r\n      confirmAddConsumer: \"کیا آپ واقعی نیا صارف شامل کرنا چاہتے ہیں؟\",\r\n      yes: \"جی ہاں\",\r\n      no: \"نہیں\",\r\n      Khata: \"خاتہ\",\r\n      Show: \"دکھائیں\",\r\n      Hide: \"چھپائیں\",\r\n      deleteWasooliConfirm: \"کیا آپ واقعی اس وصولی کو حذف کرنا چاہتے ہیں؟\",\r\n      close: \"بند کریں\",\r\n      datee: \"براہ کرم تاریخ درج کریں\",\r\n      consumerNamee: \"براہ کرم صارف کا نام درج کریں\",\r\n      baqayaa: \"براہ کرم باقیہ مقدار درج کریں\",\r\n      baqayaNumberr: \"باقیہ کو نمبر ہونا چاہئے\",\r\n      wasooliAmountt: \"براہ کرم وصولی کی رقم بھریں\",\r\n      wasooliDatee: \"تاریخ ضروری ہے\",\r\n      baqayaerror: \"برائے مہربانی باقیہ رقم بھریں\",\r\n    }\r\n\r\n  };\r\n  const monthTranslations = {\r\n    January: \"جنوری\",\r\n    February: \"فروری\",\r\n    March: \"مارچ\",\r\n    April: \"اپریل\",\r\n    May: \"مئی\",\r\n    June: \"جون\",\r\n    July: \"جولائی\",\r\n    August: \"اگست\",\r\n    September: \"ستمبر\",\r\n    October: \"اکتوبر\",\r\n    November: \"نومبر\",\r\n    December: \"دسمبر\",\r\n  };\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      const response = await fetch('http://localhost:3001/consumerkhata');\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n      const consumersData = await response.json();\r\n\r\n      // Process the data if necessary and update the state\r\n      // For each consumer, fetch their Wasooli transactions and update the state accordingly\r\n      const updatedConsumersData = await Promise.all(consumersData.map(async (consumer) => {\r\n        const wasooliResponse = await fetch(`http://localhost:3001/wasooli/${consumer.idconsumerkhata}`);\r\n        if (!wasooliResponse.ok) {\r\n          console.log(`Failed to fetch wasooli data for consumer ID: ${consumer.idconsumerkhata}`);\r\n          return consumer; // Return the consumer without wasooli data if fetch fails\r\n        }\r\n        const wasooliData = await wasooliResponse.json();\r\n        return { ...consumer, wasooliTransactions: wasooliData };\r\n      }));\r\n\r\n      // Update state with the processed and fetched data\r\n      setConsumers(updatedConsumersData);\r\n    } catch (error) {\r\n      console.error('Fetch error:', error);\r\n    }\r\n  };\r\n\r\n \r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n\r\n  const CustomModal = ({ message, onClose }) => {\r\n    return (\r\n      <div className=\"custom-modal-overlay\">\r\n        <div className=\"custom-modal\">\r\n          <div className=\"custom-modal-content\">\r\n            <p>{message}</p>\r\n            <button onClick={onClose}>Close</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const toggleMonthYearButtonsVisibility = (consumerId) => {\r\n\r\n    setMonthYearButtonsVisibility(prevState => {\r\n      const newState = {\r\n        ...prevState,\r\n        [consumerId]: !prevState[consumerId],\r\n      };\r\n\r\n      return newState;\r\n    });\r\n  };\r\n\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    let newValue = value;\r\n\r\n    // If the input is for baqaya, ensure it's handled as a number\r\n    if (name === 'baqaya') {\r\n      newValue = value !== '' ? parseInt(value, 10) : 0;\r\n      if (isNaN(newValue)) {\r\n        setErrorMessages((prevErrors) => ({\r\n          ...prevErrors,\r\n          baqaya: 'Baqaya must be a number',\r\n        }));\r\n        return; // Don't set the consumer data if the input is not a number\r\n      }\r\n    }\r\n\r\n    setConsumerData((prevData) => ({\r\n      ...prevData,\r\n      [name]: newValue,\r\n    }));\r\n\r\n    // Clear any error messages for this input\r\n    setErrorMessages((prevErrors) => ({\r\n      ...prevErrors,\r\n      [name]: '',\r\n    }));\r\n  };\r\n\r\n  const handleSaveClick = async () => {\r\n    const { date, consumerName, baqaya, idconsumerkhata } = consumerData;\r\n    let errors = {};\r\n\r\n    if (!date || !consumerName || !baqaya) {\r\n      errors = {\r\n        ...!date && { date: \"Please enter a date\" },\r\n        ...!consumerName && { consumerName: \"Please enter consumer name\" },\r\n        ...!baqaya && { baqaya: \"Please enter baqaya amount\" },\r\n      };\r\n      setErrorMessages(errors);\r\n      return;\r\n    }\r\n\r\n    const endpoint = idconsumerkhata ? `http://localhost:3001/consumerkhata/${idconsumerkhata}` : 'http://localhost:3001/consumerkhata';\r\n    const method = idconsumerkhata ? 'PUT' : 'POST';\r\n\r\n    try {\r\n      const response = await fetch(endpoint, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          Date: date,\r\n          name: consumerName,\r\n          baqaya: parseInt(baqaya),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\r\n\r\n      await fetchData();\r\n      resetForm();\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n    }\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setConsumerData({\r\n      date: '',\r\n      consumerName: '',\r\n      baqaya: '',\r\n    });\r\n    setIsFormVisible(false);\r\n    setErrorMessages({});\r\n  };\r\n\r\n\r\n  const handleCancelClick = () => {\r\n    setIsFormVisible(false);\r\n    setIsUpdateMode(false);\r\n  };\r\n\r\n  const handleUpdateClick = (id) => {\r\n    const consumerToUpdate = consumers.find(consumer => consumer.idconsumerkhata === id);\r\n    if (consumerToUpdate) {\r\n      setConsumerData({\r\n        date: consumerToUpdate.Date || '',\r\n        consumerName: consumerToUpdate.name || '',\r\n        baqaya: consumerToUpdate.baqaya || '',\r\n        idconsumerkhata: consumerToUpdate.idconsumerkhata, // Store the id in the state\r\n      });\r\n      setIsUpdateMode(true);\r\n      setIsFormVisible(true);\r\n    } else {\r\n      console.error(\"No consumer found with ID:\", id);\r\n    }\r\n  };\r\n\r\n\r\n  const handleAddBaqayaClick = () => {\r\n    setIsAddBaqayaVisible(true);\r\n  };\r\n\r\n  const handleBaqayaInputChange = (e) => {\r\n    const { value } = e.target;\r\n    setBaqayaToAdd(value);\r\n    setBaqayaError('');\r\n  };\r\n\r\n  const handleSaveBaqayaClick = async () => {\r\n    if (!baqayaToAdd) {\r\n      setBaqayaError('Please fill the Baqaya field');\r\n      return;\r\n    }\r\n    const newBaqayaAmount = parseInt(baqayaToAdd);\r\n    if (isNaN(newBaqayaAmount)) {\r\n      setBaqayaError('Invalid Baqaya amount');\r\n      return;\r\n    }\r\n\r\n    // Find the consumer to update\r\n    const consumerToUpdate = consumers.find(consumer => consumer.idconsumerkhata === selectedConsumerId);\r\n    if (!consumerToUpdate) {\r\n      console.error(\"Consumer not found\");\r\n      return;\r\n    }\r\n\r\n    // Ensure consumerToUpdate.baqaya is a number\r\n    const currentBaqaya = parseInt(consumerToUpdate.baqaya) || 0;\r\n\r\n    // Calculate updated baqaya\r\n    const updatedBaqaya = currentBaqaya + newBaqayaAmount;\r\n\r\n    // Send the update request to the server\r\n    try {\r\n      const response = await fetch(`http://localhost:3001/consumerkhata/${selectedConsumerId}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          ...consumerToUpdate,\r\n          baqaya: updatedBaqaya, // Update with the calculated baqaya\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      // Update the local state to reflect the change\r\n      const updatedConsumers = consumers.map(consumer =>\r\n        consumer.idconsumerkhata === selectedConsumerId ? {\r\n          ...consumer,\r\n          baqaya: updatedBaqaya.toString(),\r\n        } : consumer\r\n      );\r\n\r\n      setConsumers(updatedConsumers);\r\n\r\n      setIsDataSaved(true);\r\n      setBaqayaToAdd('');\r\n      setIsAddBaqayaVisible(false);\r\n      setBaqayaError('');\r\n\r\n      // Optionally, refresh the data from the server to ensure UI consistency\r\n      fetchData();\r\n    } catch (error) {\r\n      console.error('Error updating baqaya:', error);\r\n      setBaqayaError('Failed to update baqaya');\r\n    }\r\n  };\r\n\r\n  const toggleMonthVisibility = (consumerId, monthYear) => {\r\n    setMonthVisibility(prevVisibility => ({\r\n      ...prevVisibility,\r\n      [consumerId]: {\r\n        ...prevVisibility[consumerId],\r\n        [monthYear]: !(prevVisibility[consumerId]?.[monthYear] ?? false),\r\n      },\r\n    }));\r\n  };\r\n  // Adjust handleSaveClick or create a new function to send the updated consumer data to the server\r\n  // This involves crafting a PUT request with the consumer's updated data\r\n\r\n\r\n  const ConfirmAddModal = ({ isOpen, onConfirm, onCancel }) => {\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n      <div className=\"confirm-modal-overlay\">\r\n        <div className=\"confirm-modal\">\r\n          <p> {translations[language].confirmAddConsumer}</p>\r\n          {/* Check these class names match your CSS */}\r\n          <button className=\"confirm-modal-button confirm-modal-button-yes\" onClick={onConfirm}> {translations[language].yes}</button>\r\n          <button className=\"confirm-modal-button confirm-modal-button-no\" onClick={onCancel}> {translations[language].no}</button>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n\r\n  const handleAddConsumerClick = () => {\r\n    setIsAddConsumerConfirmVisible(true);\r\n  };\r\n\r\n  const handleUpdateWasooliClick = (consumerId, transactionId) => {\r\n    if (!consumerId || !transactionId) {\r\n      console.error('Missing consumer ID or transaction ID');\r\n      return;\r\n    }\r\n\r\n    const consumer = consumers.find(consumer => consumer.idconsumerkhata === consumerId);\r\n    if (!consumer) {\r\n      console.error('Consumer not found for ID:', consumerId);\r\n      setIsAlertVisible(true);\r\n      setAlertMessage(\"Error: Consumer not found\");\r\n      return;\r\n    }\r\n    console.log(\"Consumer found:\", consumer.name);\r\n\r\n    if (!consumer.wasooliTransactions || consumer.wasooliTransactions.length === 0) {\r\n      console.error('No transactions found for consumer:', consumer.name);\r\n      return;\r\n    }\r\n\r\n    console.log(\"Consumer's Wasooli Transactions:\", consumer.wasooliTransactions);\r\n\r\n    const selectedWasooliCard = consumer.wasooliTransactions.find(txn => txn.idwasooli.toString() === transactionId.toString());\r\n    if (!selectedWasooliCard) {\r\n      console.error('Wasooli transaction not found for ID:', transactionId, \"in consumer:\", consumer.name);\r\n      return;\r\n    }\r\n    console.log(\"Selected Wasooli Card:\", selectedWasooliCard);\r\n\r\n    // Update the form data and editing transaction state asynchronously\r\n    setWasooliData({\r\n      date: selectedWasooliCard.date,\r\n      wasooli: selectedWasooliCard.Wasooli.toString(),\r\n    });\r\n\r\n    setEditingTransaction({\r\n      consumerId: consumerId,\r\n      transactionId: transactionId,\r\n    });\r\n\r\n    setIsWasooliVisible(true);\r\n  };\r\n\r\n\r\n  const handleManageClick = (consumerId) => {\r\n    setSelectedConsumerId(consumerId);\r\n    setIsWasooliVisible(true);\r\n    setCurrentManaging(consumerId); // Reset Wasooli form data\r\n    setWasooliData({ date: '', Wasooli: '' });\r\n  };\r\n\r\n  const handleWasooliInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setWasooliData(prevState => ({\r\n      ...prevState,\r\n      [name]: value // Ensure this never sets `date` or `wasooli` to undefined\r\n    }));\r\n  };\r\n\r\n  const handleConfirmDeletion = async () => {\r\n    const { consumerId, wasooliId, index } = deleteConfirmationData;\r\n\r\n    if (!wasooliId) {\r\n      console.error(\"Wasooli ID is missing.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Delete the Wasooli transaction\r\n      const deleteResponse = await fetch(`http://localhost:3001/wasooli/${wasooliId}`, { method: 'DELETE' });\r\n\r\n      if (!deleteResponse.ok) {\r\n        const errorData = await deleteResponse.json();\r\n        throw new Error(errorData.message || 'Failed to delete Wasooli transaction.');\r\n      }\r\n\r\n      console.log(\"Wasooli transaction deleted successfully.\");\r\n\r\n      // Re-fetch updated consumer data to refresh local state\r\n      await fetchData();\r\n\r\n      console.log(\"Consumer data refreshed after Wasooli deletion.\");\r\n\r\n      // Reset the delete confirmation data and close the modal\r\n      setDeleteConfirmationData({ consumerId: null, wasooliId: null, index: null });\r\n      setIsConfirmModalVisible(false);\r\n    } catch (error) {\r\n      console.error('Error during Wasooli deletion:', error);\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const handleCancelDeletion = () => {\r\n    setIsConfirmModalVisible(false); // Hide the modal\r\n  };\r\n\r\n  const handleDeleteWasooliClick = (consumerId, wasooliId, index) => {\r\n    // Log the parameters to ensure they are being passed correctly\r\n    console.log(`Preparing to delete Wasooli with ID: ${wasooliId}, for Consumer ID: ${consumerId}, at Index: ${index}`);\r\n\r\n\r\n    // Set the deleteConfirmationData with the correct values\r\n    setDeleteConfirmationData({ consumerId, wasooliId, index });\r\n    setIsConfirmModalVisible(true);\r\n  };\r\n\r\n\r\n\r\n  const AlertModal = ({ isOpen, message, onClose }) => {\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n      <div className=\"alert-modal-overlay\">\r\n        <div className=\"alert-modal\">\r\n          <p>{message}</p>\r\n          <button onClick={onClose}>OK</button>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const ConfirmationModal = ({ onConfirm, onCancel }) => {\r\n    return (\r\n      <div className=\"confirmation-modal-overlay\">\r\n        <div className=\"confirmation-modal\">\r\n          <p> {translations[language].deleteWasooliConfirm}</p>\r\n          <button className=\"yes-button\" onClick={onConfirm}> {translations[language].yes}</button>\r\n          <button className=\"no-button\" onClick={onCancel}> {translations[language].no}</button>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const handleSaveWasooliClick = async () => {\r\n    try {\r\n      const wasooliAmount = parseInt(wasooliData.wasooli);\r\n\r\n      if (wasooliAmount <= 0) {\r\n        throw new Error(\"invalid Wasooli amount\");\r\n      }\r\n\r\n      if (isNaN(wasooliAmount) ) {\r\n        throw new Error(\"Please fill up the Wasooli amount\");\r\n      }\r\n\r\n      if (!wasooliData.date) {\r\n        throw new Error(\"Date is required\");\r\n      }\r\n\r\n      let payload = {\r\n        date: wasooliData.date,\r\n        Wasooli: wasooliAmount,\r\n      };\r\n\r\n      let endpoint = 'http://localhost:3001/wasooli';\r\n      let method = 'POST';\r\n\r\n      // If we're editing an existing transaction, adjust the endpoint and method.\r\n      // Otherwise, ensure the consumer ID is included in the payload for new transactions.\r\n      if (editingTransaction && editingTransaction.transactionId) {\r\n        endpoint += `/${editingTransaction.transactionId}`;\r\n        method = 'PUT';\r\n      } else {\r\n        // For new transactions, include the consumerId in the payload\r\n        if (!selectedConsumerId) {\r\n          throw new Error(\"Consumer ID is missing for new Wasooli transaction\");\r\n        }\r\n        payload = { ...payload, consumerId: selectedConsumerId };\r\n      }\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.message || \"Failed to save Wasooli transaction\");\r\n      }\r\n\r\n      console.log(\"Wasooli transaction saved:\", await response.json());\r\n\r\n      setIsWasooliVisible(false);\r\n      setWasooliData({ date: '', wasooli: '' });\r\n      setEditingTransaction(null);\r\n      await fetchData();\r\n\r\n    } catch (error) {\r\n      console.error(\"Error saving Wasooli transaction:\", error);\r\n      setIsAlertVisible(true);\r\n      setAlertMessage(error.toString());\r\n    }\r\n  };\r\n\r\n  // Toggle visibility for an individual month (optional, if you need finer control)\r\n\r\n  const renderWasooliTransactions = (consumer) => {\r\n    // Ensure consumer.wasooliTransactions is an array.\r\n    const transactions = consumer.wasooliTransactions || [];\r\n    const transactionsByMonth = transactions.reduce((acc, transaction) => {\r\n      const monthYear = new Date(transaction.date).toLocaleString('default', { month: 'long', year: 'numeric' });\r\n      if (!acc[monthYear]) acc[monthYear] = [];\r\n      acc[monthYear].push(transaction);\r\n      return acc;\r\n    }, {});\r\n\r\n    return Object.entries(transactionsByMonth).map(([monthYear, transactions]) => {\r\n      // Check if the monthYear is visible based on the state.\r\n      const isButtonVisible = monthYearButtonsVisibility[consumer.idconsumerkhata];\r\n      const isDataVisible = monthVisibility[consumer.idconsumerkhata]?.[monthYear] ?? false;\r\n      return (\r\n\r\n        <div key={monthYear}>\r\n         {isButtonVisible && (\r\n            <button className=\"toggle-visibility-button\" onClick={() => toggleMonthVisibility(consumer.idconsumerkhata, monthYear)}>\r\n              {isDataVisible ? translations[language].Hide : translations[language].Show} {monthYear}\r\n            </button>\r\n          )} \r\n          {isDataVisible && transactions.map((transaction, index) => (\r\n            <div className=\"wasooli-card-horizontal\" key={index}>\r\n              {/* Ensure the property names match what's returned from the database. */}\r\n              <span>{translations[language].date} : {transaction.date}</span> {/* If your database returns 'date' in lowercase */}\r\n              <span>{translations[language].wasooli} : {transaction.Wasooli}</span> {/* If your database returns 'wasooli' in lowercase */}\r\n              <button className=\"updatee-button\" onClick={() => handleUpdateWasooliClick(consumer.idconsumerkhata, transaction.idwasooli)}>\r\n                {translations[language].update}\r\n              </button>\r\n              <button className=\"deletee-button\" onClick={() => handleDeleteWasooliClick(consumer.idconsumerkhata, transaction.idwasooli, index)}>\r\n                {translations[language].delete}\r\n              </button>\r\n\r\n            </div>\r\n          ))}\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n\r\n  return (\r\n    <div className=\"consumer-khata-container\">\r\n      <h1 className=\"header\">{translations[language].consumerKhata}</h1>\r\n      <button onClick={() => setLanguage(lang => lang === 'English' ? 'Urdu' : 'English')} className=\"language-toggle\">\r\n        {language === 'English' ? 'اردو' : 'English'}\r\n      </button>\r\n      {isConfirmModalVisible && (\r\n        <ConfirmationModal onConfirm={handleConfirmDeletion} onCancel={handleCancelDeletion} />\r\n\r\n      )}\r\n      <AlertModal\r\n        isOpen={isAlertVisible}\r\n        message={alertMessage}\r\n        onClose={() => setIsAlertVisible(false)}\r\n      />\r\n      {\r\n        consumers.map((consumer) => (\r\n          <div className=\"consumer-card\" key={consumer.idconsumerkhata}>\r\n            <h2 className=\"consumer-name\">{consumer.name} {translations[language].Khata}</h2>\r\n            <p>{translations[language].date} : {consumer.Date}</p>\r\n            <p>{translations[language].consumerName} : {consumer.name}</p>\r\n            <p>{translations[language].baqaya} : {consumer.baqaya}</p>\r\n            <div className=\"action-buttons\">\r\n              <button className=\"manage-buttonn\" onClick={() => handleManageClick(consumer.idconsumerkhata)}>\r\n                {translations[language].manage}\r\n              </button>\r\n              <button className=\"add-baqaya-buttonn\" onClick={() => {\r\n                setIsAddBaqayaVisible(true);\r\n                setSelectedConsumerId(consumer.idconsumerkhata); // Ensure this is set when opening the Baqaya add form\r\n              }}>\r\n                {translations[language].addBaqaya}\r\n              </button>\r\n              <button className=\"update-buttonn\" onClick={() => handleUpdateClick(consumer.idconsumerkhata)}>\r\n                {translations[language].update}\r\n              </button>\r\n\r\n            </div>\r\n            <button className=\"global-toggle-buttonn\" onClick={() => toggleMonthYearButtonsVisibility(consumer.idconsumerkhata)}>\r\n              {monthYearButtonsVisibility[consumer.idconsumerkhata] ? translations[language].hideAll : translations[language].showAll}\r\n            </button>\r\n\r\n            {renderWasooliTransactions(consumer)}\r\n\r\n            {currentManaging === consumer.idconsumerkhata && isWasooliVisible && (\r\n              <div className=\"form-container wasooli-card\">\r\n                <h2>{translations[language].wasooli}</h2>\r\n                <button className=\"close-button\" onClick={() => setIsWasooliVisible(false)}>\r\n                  &#10005;\r\n                </button>\r\n                <span className=\"error-message\">{wasooliErrorMessages.date}</span>\r\n                <input\r\n                  type=\"date\"\r\n                  name=\"date\"\r\n                  placeholder={translations[language].datee}\r\n                  value={wasooliData.date || ''}\r\n                  onChange={handleWasooliInputChange}\r\n                />\r\n\r\n                <span className=\"error-message\">{wasooliErrorMessages.wasooli}</span>\r\n                <input\r\n                  type=\"number\"\r\n                  name=\"wasooli\"\r\n                  placeholder={translations[language].wasooliAmountt}\r\n                  value={wasooliData.wasooli || ''} // Fallback to empty string if undefined\r\n                  onChange={handleWasooliInputChange}\r\n                />\r\n\r\n                <button className=\"save-button\" onClick={(e) => {\r\n                  e.preventDefault();\r\n                  handleSaveWasooliClick();\r\n                }}>\r\n                  {translations[language].saveWasooli}\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {selectedConsumerId === consumer.idconsumerkhata && isAddBaqayaVisible && (\r\n              <div className=\"add-baqaya-card\">\r\n                <button className=\"close-button\" onClick={() => setIsAddBaqayaVisible(false)} >\r\n                  &#10005;\r\n                </button>\r\n                <span className=\"error-message\">{baqayaError}</span>\r\n                <input\r\n                  type=\"number\"\r\n                  placeholder={translations[language].baqayaa}\r\n                  value={baqayaToAdd}\r\n                  onChange={handleBaqayaInputChange}\r\n                />\r\n\r\n                <button className=\"save-baqaya-button\" onClick={handleSaveBaqayaClick}>\r\n                  {translations[language].save}\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n          </div>\r\n\r\n        ))\r\n      }\r\n      <ConfirmAddModal\r\n        isOpen={isAddConsumerConfirmVisible}\r\n        onConfirm={() => {\r\n          setIsAddConsumerConfirmVisible(false);\r\n          setIsFormVisible(true); // Show the form if the user confirms\r\n        }}\r\n        onCancel={() => setIsAddConsumerConfirmVisible(false)}\r\n      />\r\n      {isFormVisible && (\r\n        <div className=\"form-container\">\r\n          <button className=\"close-button\" onClick={handleCancelClick}>\r\n            &#10005;\r\n          </button>\r\n          <span className=\"error-message\">{errorMessages.date}</span>\r\n          <input\r\n            type=\"date\"\r\n            name=\"date\"\r\n            placeholder={translations[language].datee}\r\n            value={consumerData.date}\r\n            onChange={handleInputChange}\r\n          />\r\n\r\n          <span className=\"error-message\">{errorMessages.consumerName}</span>\r\n          <input\r\n            type=\"text\"\r\n            name=\"consumerName\"\r\n            placeholder={translations[language].consumerNamee}\r\n            value={consumerData.consumerName}\r\n            onChange={handleInputChange}\r\n          />\r\n\r\n          <span className=\"error-message\">{errorMessages.baqaya}</span>\r\n          <input\r\n            type=\"text\"\r\n            name=\"baqaya\"\r\n            placeholder={translations[language].baqayaa}\r\n            value={consumerData.baqaya}\r\n            onChange={handleInputChange}\r\n          />\r\n\r\n          <button className=\"save-button\" onClick={handleSaveClick}>\r\n            {translations[language].save}\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      <button className=\"add-button\" onClick={handleAddConsumerClick}>\r\n        {translations[language].addConsumer}\r\n      </button>\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ConsumerKhata;"]},"metadata":{},"sourceType":"module"}